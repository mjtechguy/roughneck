---
# =============================================================================
# Claude Code CLI Installation Role
# =============================================================================
# Installs Claude Code CLI via npm. Users authenticate after deployment
# by running 'claude login'.

- name: Download Node.js 22.x setup script
  get_url:
    url: https://deb.nodesource.com/setup_22.x
    dest: /tmp/nodesource_setup.sh
    mode: "0755"

- name: Run NodeSource setup
  command: /tmp/nodesource_setup.sh
  args:
    creates: /etc/apt/sources.list.d/nodesource.list

- name: Install Node.js
  apt:
    name: nodejs
    state: present
    update_cache: true

- name: Install Claude Code CLI via npm
  npm:
    name: "@anthropic-ai/claude-code"
    global: true
    state: present

- name: Verify Claude CLI installation
  command: claude --version
  register: claude_version
  changed_when: false
  failed_when: false

- name: Display Claude CLI status
  debug:
    msg: "Claude Code CLI installed. Run 'claude login' to authenticate."
